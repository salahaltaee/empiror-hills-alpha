<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emperor Hills Alpha – تسجيل الدخول</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{ font-family:'Cairo',system-ui; background:#0f172a0a; }
    .card{ border-radius:16px; box-shadow:0 8px 24px #00000012 }
    .btn-pill{ border-radius:999px }
  </style>
</head>
<body>
  <main class="container py-5" style="max-width:680px">
    <div class="card p-4">
      <h4 class="mb-3">تسجيل الدخول</h4>
      <div class="mb-2">
        <label class="form-label">البريد</label>
        <input id="email" type="email" class="form-control" placeholder="name@example.com" />
      </div>
      <div class="mb-3">
        <label class="form-label">كلمة المرور</label>
        <input id="password" type="password" class="form-control" placeholder="••••••••" />
      </div>
      <div class="d-flex gap-2">
        <button id="btnLogin" class="btn btn-primary btn-pill">دخول</button>
        <button id="btnReset" class="btn btn-light btn-pill">استرجاع كلمة المرور</button>
      </div>
      <div id="msg" class="small text-muted mt-2"></div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAP5RViS9WdyEo8EaBflHyFag_T9_NKT7w",
      authDomain: "empiror-hills-alpha.firebaseapp.com",
      projectId: "empiror-hills-alpha",
      storageBucket: "empiror-hills-alpha.appspot.com",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    function goto(role){
      if(role==='admin') location.href='Admin.html';
      else if(role==='ops') location.href='ops.htm';
      else location.href='Tech.html';
    }

    btnLogin.onclick = async ()=>{
      msg.textContent='';
      try{
        const cred = await auth.signInWithEmailAndPassword(email.value.trim(), password.value);
        const udoc = await db.collection('users').doc(cred.user.uid).get();
        const role = udoc.data()?.role || 'tech';
        if(udoc.exists && udoc.data().isActive===false){ msg.textContent='الحساب غير مفعّل'; return; }
        goto(role);
      }catch(e){ msg.textContent='خطأ: '+(e.message||e.code); }
    };

    btnReset.onclick = async ()=>{
      try{ await auth.sendPasswordResetEmail(email.value.trim()); msg.textContent='تم إرسال رابط الاسترجاع للبريد'; }
      catch(e){ msg.textContent='خطأ: '+(e.message||e.code); }
    };
  </script>
</body>
</html>
